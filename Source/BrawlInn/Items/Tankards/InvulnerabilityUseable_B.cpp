// Fill out your copyright notice in the Description page of Project Settings.


#include "InvulnerabilityUseable_B.h"
#include "GameFramework/CharacterMovementComponent.h"

#include "BrawlInn.h"
#include "Characters/Player/PlayerCharacter_B.h"
#include "Components/PunchComponent_B.h"

void AInvulnerabilityUseable_B::Use_Implementation()
{
	Character = Cast<APlayerCharacter_B>(GetAttachParentActor());
	if (!Character) { BWarn("Could not find player while using, something is wrong! ABORT!"); return; }

	OldMovementSpeed = Character->NormalMaxWalkSpeed;
	OldAcceleration = Character->GetCharacterMovement()->MaxAcceleration;

	Character->MakeInvulnerable();
	Character->GetCharacterMovement()->MaxAcceleration = OldAcceleration + AccelerationBoost;
	Character->GetCharacterMovement()->MaxWalkSpeed = OldMovementSpeed + MovementSpeedBoost;
	Character->NormalMaxWalkSpeed = OldMovementSpeed + MovementSpeedBoost;

	if (Character->PunchComponent)
	{
		Character->PunchComponent->SetCanPunch(false);
		Character->PunchComponent->SetCanDash(false);
	}
	BWarn("boosting!");
	Character->SetState(EState::EPoweredUp);

	Super::Use_Implementation();
}

void AInvulnerabilityUseable_B::ResetBoost()
{
	if (Character)
	{
		Character->SetState(EState::EWalking);
		if (Character->PunchComponent)
		{
			Character->PunchComponent->SetCanPunch(true);
			Character->PunchComponent->SetCanDash(false);
		}


		BWarn("Setting boost back!");
		Character->MakeVulnerable();
		Character->GetCharacterMovement()->MaxWalkSpeed = OldMovementSpeed;
		Character->GetCharacterMovement()->MaxAcceleration = OldAcceleration;
		Character->NormalMaxWalkSpeed = OldMovementSpeed;
	}
}
